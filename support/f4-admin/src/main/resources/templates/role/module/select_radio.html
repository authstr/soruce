<!doctype html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta content="always" name="referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <#include "../common/header.html">
</head>
<body>
<!--最外面的灰底框,用于与ifram区别开-->
<div class="col-xs-12 lightgray_div">
    <!--白底框-->
    <div class="col-xs-12 white_div">
        <!--搜索框-->
        <div class="col-xs-12 search_div">
            <div class="input-group g-fr">
                <form id="inquire" class="form-inline ">

                    <div class="input-group ">
                        <input type="text" class="form-control" id="name" name="name" placeholder="角色名称">
                    </div>
                    <button type="button" class="layui-btn" style="height: 30px" onclick="table_func.search()"><i
                            class="layui-icon layui-icon-search"></i></button>
                </form>
            </div>
        </div>
        <div class="col-xs-12">
            <div>
                <div class="layui-table-tool" style="margin-bottom: -11px;margin-top: 10px">
                    <div class="layui-table-tool-temp">
                        <div style="margin-bottom: -5px">

                            <div class="layui-table-tool-self">
                                <div class="layui-inline" title="展开所有" lay-event="LAYTABLE_COLS" onclick="table_func.expandAll()" >
                                    <i class="layui-icon layui-icon-triangle-d"></i>
                                </div>
                                <div class="layui-inline" title="折叠所有" lay-event="LAYTABLE_EXPORT" onclick="table_func.foldAll()"  id="">
                                    <i class="layui-icon layui-icon-template-1"></i>
                                </div>
                                <!--<div class="layui-inline" title= lay-event="LAYTABLE_PRINT"><i class="layui-icon layui-icon-print"></i></div>-->
                            </div>
                        </div>
                    </div>
                </div>
                <table id="table_div" lay-filter="main"></table>
            </div>
        </div>
    </div>
</div>
</body>

<script type="text/javascript">
    //树状表格 表头
    var cols = [
        {type: 'radio'}
        , {field: 'name', title: '角色名称'}
        , {field: 'remark', title: '备注'}
        , {
            field: 'gmt_create', title: '创建时间'
            , templet: function (col) {
                return layui_table.date_format(col.gmt_create, "yyyy-MM-dd hh:mm:ss")
            }
        },
        {
            field: 'gmt_create', title: '修改时间'
            , templet: function (col) {
                return layui_table.date_format(col.gmt_modified, "yyyy-MM-dd hh:mm:ss")
            }
        }
    ]
    //页面要用的方法
    table_func = {
        //树状表格对象
        tableTree_obj:null,
        //表格初始化
        init: function () {
            var para = paraArrayToLiteral($("#inquire").serializeArray());
            $.getJSON("${request.contextPath}/role/getAll", para,function (o) {
                if (o.code == 0) {
                    // 渲染表格
                    tableTree_obj =  layui.treeTable.render({
                        elem: '#table_div'
                        , id: "tableTree_id"
                        ,data: o.data  // 数据
                        ,tree: {
                            isPidData:true,
                            iconIndex: 1 // 折叠图标显示在第几列
                            ,idName:"id"
                            , pidName:'parent_id'
                            ,openName:'name'
                        },
                        cols: cols
                    });
                }
            });
        },
        //搜索
        search: function () {
            tableTree_obj.filterData($("#name").val());
        },
        //添加
        add: function () {
            window.location.href = "${request.contextPath}/pages/role/add";
        },
        //编辑
        edit: function () {
           // 获取选中数据
            var id =  tableTree_obj.checkStatus()[0].id;
            if (id != null) {
                window.location.href = "${request.contextPath}/pages/role/edit?id=" + id;
            }
        },
        // 展开全部
        expandAll:function(){
            tableTree_obj.expandAll();
        },
        //  折叠全部
        foldAll:function(){
            tableTree_obj.foldAll();
        },
        //删除
        delete: function () {
            var id = tableTree_obj.checkStatus()[0].id;
            if (id != null) {
                layui_layer.confirm("确定要删除当前角色吗?该角色之下的角色不会被删除",function () {
                    $.post("${request.contextPath}/role/delete", {ids:id}, function (o) {
                        if (o.code == 0) {
                            layer.msg(o.message);
                            table_func.init();
                        } else {
                            layui_layer.error_alert(o.message);
                        }
                    });
                })
            }
        },
        //删除关联
        delete_relevance: function () {
            var id = tableTree_obj.checkStatus()[0].id;
            if (id != null) {
                layui_layer.confirm("确定要删除当前角色和当前角色下的所有子角色吗?",function () {
                    $.post("${request.contextPath}/role/delete", {ids:id}, function (o) {
                        if (o.code == 0) {
                            layer.msg(o.message);
                            table_func.init();
                        } else {
                            layui_layer.error_alert(o.message);
                        }
                    });
                })
            }
        }
    }
    $(function () {
        //设置表格的属性值
        // layui_table.lay_attr = $("#table_div").attr("lay-filter");
        //设置点击表格行,进行选中
        // layui_table.click_line_checked();

        //渲染日期选择框
        // layui_date.range_date_render("#gmt_create", "date", "#gmt_create_start", "#gmt_create_end");
        // $("#role").select2();
        table_func.init();
    });
</script>
<#include "../common/footer-inner.html">
</html>
